<link rel="import" href="../components/bower_components/polymer/polymer.html" />
<link href="../components/bower_components/iron-ajax/iron-ajax.html" rel="import" />
<link href="../components/bower_components/app-layout/app-layout.html" rel="import" />
<link href="../components/bower_components/paper-card/paper-card.html" rel="import" />
<link href="../components/bower_components/paper-button/paper-button.html" rel="import" />
<link href="../components/bower_components/iron-icons/iron-icons.html" rel="import" />
<link href="../components/bower_components/paper-icon-button/paper-icon-button.html" rel="import" />
<link href="../components/bower_components/paper-toolbar/paper-toolbar.html" rel="import" />
<link href="../components/bower_components/paper-input/paper-input.html" rel="import" />

<dom-module name="api-consume">
    <template>
        <app-toolbar>
            <paper-icon-button icon="menu"></paper-icon-button>
            <div title>Spork</div>
            <paper-icon-button icon="search" on-click="consumeapi">Only one</paper-icon-button>
        </app-toolbar>

        <paper-button raised on-click="consumeapimysql">Search person</paper-button>

        <iron-ajax id="ajaxGet" auto
                   url="http://localhost:5984/voteup/_all_docs?limit=100&include_docs=true"
                   last-response="{{blogs}}"
                   handle-as="json">
        </iron-ajax>

        <iron-ajax id="ajaxPost" url="http://localhost:3000/api/person/" method="POST" on-response="_refresh"></iron-ajax>
        <iron-ajax id="ajaxGetMySQL" url="http://localhost:3000/api/person/1" method="GET" last-response="{{persons}}" handle-as="json"></iron-ajax>
        <iron-ajax id="ajaxDelete" method="DELETE" on-response="_refresh"></iron-ajax>
        <div>
            <paper-input label="Please insert limit number:" on-input="consumeapi" value="{{limitnumber}}"></paper-input>
        </div>
        <template is="dom-repeat" items={{blogs.rows}} as={{blog}} index-as=index>
            <paper-card heading="PersonId: {{person.id}}">
                <div class="header">{{person.Name}} {{person.Surname}}</div>
                <div class="card-content">
                    <span>{{person.Name}}  and url: {{person.fotourl}}</span>
                    <br />

                    <!-- {{item}} and {{index}} can be used in this binding scope -->
                    
                    <div>
                        <h2>{{blog.title}}</h2>
                        <span>{{blog.contentblob}}</span>
                    </div>

                    <content>
                    </content>
                </div>
                <div class="card-actions">
                    <paper-button>Vote up</paper-button>
                    <paper-button>Vote Down</paper-button>
                </div>
            </paper-card>
        </template>
        <template is="dom-repeat" items={{persons}} as={{item}} index-as=index>
            <paper-card elavation="5" heading="PersonId: {{item.id}}">
                <div class="header">{{item.Name}} {{item.Surname}}</div>
                <div class="card-content">
                    <div>
                        <img style="width:100px;height:100px" src="/images/{{item.fotourl}}" alt="{{item.Name}} {{item.Surname}}">
                    </div>
                </div>
                <div class="card-actions">
                    <paper-button>Vote up</paper-button>
                    <paper-button>Vote Down</paper-button>
                </div>
            </paper-card>
            
           
        </template>
    </template>
    <script>
        Polymer({
            is: "api-consume",
            properties: {
                limitnumber: {
                    type: Number,
                    value: 1
                },
                person: {
                    type: Object,
                    value: function () {
                        return { id: 1, Name: "Rob", Surname: "Bob", fotourl: "Nan" };
                    }
                },
                blog: {
                    type: Object,
                    value: function () {
                        return { title: "Rob", contentblob: "Bob", id: "Nan" };
                    }
                },
                querystring: String,
                resultdetail: String
            },
            consumeapimysql: function () {
                this.$.ajaxGetMySQL.generateRequest()
                console.log(this.persons);
                console.log(this.blogs);
                console.log(this.naim);
            },
            consumeapi: function () {
                this.$.ajaxGet.url = "http://localhost:5984/voteup/_all_docs?limit=" + this.limitnumber + "&include_docs=true";
                this.blogs = this.$.ajaxGet.generateRequest();
            },
            insertEntry: function (entry) {
                this.$.ajaxPost.body = JSON.stringify(entry);
                this.$.ajaxPost.generateRequest();
            },

            _handleRemove: function (e) {
                var entry = e.currentTarget.entry;
                this.$.ajaxDelete.url = "/cart-api/" + entry.id;
                this.$.ajaxDelete.generateRequest();
            },

            _refresh: function () {
                this.$.ajaxGet.generateRequest();
            }
        });
    </script>
</dom-module>