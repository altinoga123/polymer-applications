<link rel="import" href="../components/bower_components/polymer/polymer.html" />
<dom-module name="calculator-element">
    <link href="../components/bower_components/paper-button/paper-button.html" rel="import" />
    <link href="../components/bower_components/paper-card/paper-card.html" rel="import" />
    <link href="../components/bower_components/paper-input/paper-input.html" rel="import" />
    <link href="../components/bower_components/iron-flex-layout/iron-flex-layout.html" rel="import" />
    <template>
        <style>
            paper-button {
                background-color: red;
                color: white;
                margin: 10px;
            }

            paper-input {
                text-align: right;
            }
        </style>
        <paper-card heading="Makine Llogaritese">
            <div class="card-content">
                <div layout horizontal>
                    <paper-input label="Result" value="{{result}}" flex></paper-input>
                    <div layout horizontal>
                        <paper-button>1</paper-button>
                        <paper-button>2</paper-button>
                        <paper-button>3</paper-button>
                        <paper-button>4</paper-button>
                        <paper-button>*</paper-button>

                    </div>
                    <div layout horizontal>
                        <paper-button>5</paper-button>
                        <paper-button>6</paper-button>
                        <paper-button>7</paper-button>
                        <paper-button>8</paper-button>
                        <paper-button>-</paper-button>

                    </div>
                    <div layout horizontal>
                        <paper-button>9</paper-button>
                        <paper-button>0</paper-button>
                        <paper-button>(</paper-button>
                        <paper-button>)</paper-button>
                        <paper-button>+</paper-button>
                    </div>
                    <div layout horizontal>

                        <paper-button on-click="clear" >Clear</paper-button>
                        <paper-button on-click="backspace" style="width:170px">BackSpace</paper-button>
                        <paper-button raised style="width:170px" on-click="resultCalculated">=</paper-button>
                    </div>
                </div>
            </div>
        </paper-card>
        <input type="hidden" name="setToClear" id="setToClear" value="0" />
    </template>
    <script>
        Polymer({
            is: "calculator-element",
            properties: {
                result: String,
                action: String
            },

            ready: function () {
                this.result = 0;
                this.$.setToClear.value = 0;
            },

            listeners: {
                'tap': 'setNumber'
            },

            setForClear: function (clear) {
                this.$.setToClear.value = clear
            },

            setNumber: function (e, detail, sender) {
                if (this.$.setToClear.value == 1) {
                    this.result = 0;
                    this.setForClear(0);
                }
                if (e.target.innerText != '' && e.target.innerText.length == 1 && e.target.innerText != '=') {
                    if (this.result == 0 || ['*', '-', '+', '='].indexOf(this.result) > -1) this.result = '';
                    this.result = this.result + '' + e.target.innerText;
                }
            },

            resultCalculated: function () {
                if (['*', '-', '+', '='].indexOf(this.result.substring(this.result.length, this.result.length - 1)) == -1) {
                    this.result = eval(this.result);
                    this.setForClear(1);
                }
            },
            clear: function () {
                this.result = 0;
            },
            backspace: function () {
                if (this.result.length > 1)
                    this.result = this.result.substring(0, this.result.length - 1);
                else
                    this.result = 0;
            }

        });
    </script>
</dom-module>