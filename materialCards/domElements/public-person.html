<link rel="import" href="../components/bower_components/polymer/polymer.html" />
<link rel="import" href="../components/bower_components/paper-card/paper-card.html" />
<link rel="import" href="../components/bower_components/paper-button/paper-button.html" />
<link rel="import" href="../components/bower_components/deepstream.io-tools-polymer/ds-connection.html">
<link rel="import" href="../components/bower_components/deepstream.io-tools-polymer/ds-login.html">
<link rel="import" href="../components/bower_components/deepstream.io-tools-polymer/ds-record.html">

<dom-module name="public-person">
    <template>
        <ds-connection url="localhost:6020" state="{{connectionState}}" ds={{ds}}>
        </ds-connection>
        <ds-login auto-login ds="[[ds]]">
        </ds-login>
        <div class$="[[connectionState]]">
            <ds-record name="[[personname]]" ds="[[ds]]" data={{vote}}>
                <paper-card heading={{personname}}>
                    <div class="card-content">
                        <h3> Vote up {{vote.value}}</h3>
                        <img src="/images/{{personname}}.jpg" height="100" width="100" alt="{{personname}}" />
                        <br />
                        <content>
                        </content>
                    </div>
                    <div class="card-actions">
                        <paper-button on-click="voteup">Vote up</paper-button>
                        <paper-button on-click="votedown">Vote Down</paper-button>
                    </div>
                </paper-card>
            </ds-record>
        </div>
    </template>

    <script>
        Polymer({
            is: "public-person",
            properties: {
                votes: {
                    type: Number,
                    value: 0,
                    computed: '_checkVotes( vote.value )'
                },
                personname: String
            },
            voteup: function (event) {
                var dsRecord = this.$$('ds-record');
                dsRecord.set('data.value', dsRecord.data.value + 1);

            },
            votedown: function () {
                var dsRecord = this.$$('ds-record');
                dsRecord.set('data.value', dsRecord.data.value - 1);
            },
            _checkVotes: function() {
                var dsRecord = this.$$('ds-record');
                if (dsRecord.data)
                    return dsRecord.data.value;
                else
                {
                    var record = this.ds.getRecord(this.personname);
                    record.set({
                        name: this.personname, value: 0
                    });
                    return 0;
                }
            }
        });
    </script>
</dom-module>